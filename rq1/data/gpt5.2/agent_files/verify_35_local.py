import stim

# Load circuit
with open("circuit_35_gen.stim", "r") as f:
    circuit_text = f.read()
circuit = stim.Circuit(circuit_text)

# Load stabilizers
stabilizers = [
    "XZZXIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII",
    "IIIIIXZZXIIIIIIIIIIIIIIIIIIIIIIIIII",
    "IIIIIIIIIIXZZXIIIIIIIIIIIIIIIIIIIII",
    "IIIIIIIIIIIIIIIXZZXIIIIIIIIIIIIIIII",
    "IIIIIIIIIIIIIIIIIIIIXZZXIIIIIIIIIII",
    "IIIIIIIIIIIIIIIIIIIIIIIIIXZZXIIIIII",
    "IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIXZZXI",
    "IXZZXIIIIIIIIIIIIIIIIIIIIIIIIIIIIII",
    "IIIIIIXZZXIIIIIIIIIIIIIIIIIIIIIIIII",
    "IIIIIIIIIIIXZZXIIIIIIIIIIIIIIIIIIII",
    "IIIIIIIIIIIIIIIIXZZXIIIIIIIIIIIIIII",
    "IIIIIIIIIIIIIIIIIIIIIXZZXIIIIIIIIII",
    "IIIIIIIIIIIIIIIIIIIIIIIIIIXZZXIIIII",
    "IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIXZZX",
    "XIXZZIIIIIIIIIIIIIIIIIIIIIIIIIIIIII",
    "IIIIIXIXZZIIIIIIIIIIIIIIIIIIIIIIIII",
    "IIIIIIIIIIXIXZZIIIIIIIIIIIIIIIIIIII",
    "IIIIIIIIIIIIIIIXIXZZIIIIIIIIIIIIIII",
    "IIIIIIIIIIIIIIIIIIIIXIXZZIIIIIIIIII",
    "IIIIIIIIIIIIIIIIIIIIIIIIIXIXZZIIIII",
    "IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIXIXZZ",
    "ZXIXZIIIIIIIIIIIIIIIIIIIIIIIIIIIIII",
    "IIIIIZXIXZIIIIIIIIIIIIIIIIIIIIIIIII",
    "IIIIIIIIIIZXIXZIIIIIIIIIIIIIIIIIIII",
    "IIIIIIIIIIIIIIIZXIXZIIIIIIIIIIIIIII",
    "IIIIIIIIIIIIIIIIIIIIZXIXZIIIIIIIIII",
    "IIIIIIIIIIIIIIIIIIIIIIIIIZXIXZIIIII",
    "IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIZXIXZ",
    "IIIIIIIIIIXXXXXIIIIIXXXXXXXXXXXXXXX",
    "IIIIIXXXXXIIIIIXXXXXIIIIIXXXXXXXXXX",
    "XXXXXXXXXXXXXXXIIIIIIIIIIXXXXXIIIII",
    "IIIIIIIIIIZZZZZIIIIIZZZZZZZZZZZZZZZ",
    "IIIIIZZZZZIIIIIZZZZZIIIIIZZZZZZZZZZ",
    "ZZZZZZZZZZZZZZZIIIIIIIIIIZZZZZIIIII"
]

sim = stim.TableauSimulator()
sim.do_circuit(circuit)

success = True
for i, s in enumerate(stabilizers):
    p = stim.PauliString(s)
    ex = sim.peek_observable_expectation(p)
    if ex != 1:
        print(f"Stabilizer {i} failed: {s}, expectation {ex}")
        success = False

if success:
    print("All stabilizers verified locally.")
else:
    print("Verification failed.")
