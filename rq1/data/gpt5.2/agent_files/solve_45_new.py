import stim
import sys

def solve():
    stabilizers = [
        "XXIXXIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII",
        "IIIIIIIIIXXIXXIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII",
        "IIIIIIIIIIIIIIIIIIXXIXXIIIIIIIIIIIIIIIIIIIIII",
        "IIIIIIIIIIIIIIIIIIIIIIIIIIIXXIXXIIIIIIIIIIIII",
        "IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIXXIXXIIII",
        "IIIIXXIXXIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII",
        "IIIIIIIIIIIIIXXIXXIIIIIIIIIIIIIIIIIIIIIIIIIII",
        "IIIIIIIIIIIIIIIIIIIIIIXXIXXIIIIIIIIIIIIIIIIII",
        "IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIXXIXXIIIIIIIII",
        "IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIXXIXX",
        "IIXIIXIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII",
        "IIIIIIIIIIIXIIXIIIIIIIIIIIIIIIIIIIIIIIIIIIIII",
        "IIIIIIIIIIIIIIIIIIIIXIIXIIIIIIIIIIIIIIIIIIIII",
        "IIIIIIIIIIIIIIIIIIIIIIIIIIIIIXIIXIIIIIIIIIIII",
        "IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIXIIXIII",
        "IIIXIIXIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII",
        "IIIIIIIIIIIIXIIXIIIIIIIIIIIIIIIIIIIIIIIIIIIII",
        "IIIIIIIIIIIIIIIIIIIIIXIIXIIIIIIIIIIIIIIIIIIII",
        "IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIXIIXIIIIIIIIIII",
        "IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIXIIXII",
        "IIIZZIZZIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII",
        "IIIIIIIIIIIIZZIZZIIIIIIIIIIIIIIIIIIIIIIIIIIII",
        "IIIIIIIIIIIIIIIIIIIIIZZIZZIIIIIIIIIIIIIIIIIII",
        "IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIZZIZZIIIIIIIIII",
        "IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIZZIZZI",
        "IZZIZZIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII",
        "IIIIIIIIIIZZIZZIIIIIIIIIIIIIIIIIIIIIIIIIIIIII",
        "IIIIIIIIIIIIIIIIIIIZZIZZIIIIIIIIIIIIIIIIIIIII",
        "IIIIIIIIIIIIIIIIIIIIIIIIIIIIZZIZZIIIIIIIIIIII",
        "IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIZZIZZIII",
        "ZZIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII",
        "IIIIIIIIIZZIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII",
        "IIIIIIIIIIIIIIIIIIZZIIIIIIIIIIIIIIIIIIIIIIIII",
        "IIIIIIIIIIIIIIIIIIIIIIIIIIIZZIIIIIIIIIIIIIIII",
        "IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIZZIIIIIII",
        "IIIIIIIZZIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII",
        "IIIIIIIIIIIIIIIIZZIIIIIIIIIIIIIIIIIIIIIIIIIII",
        "IIIIIIIIIIIIIIIIIIIIIIIIIZZIIIIIIIIIIIIIIIIII",
        "IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIZZIIIIIIIII",
        "IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIZZ",
        "IIXXXIIIIZIIZIIZIIZIIZIIZIIIIXXXIIIIIIIIIIIII",
        "IIIIIIIIIIIXXXIIIIZIIZIIZIIZIIZIIZIIIIXXXIIII",
        "IIXXXIIIIIIIIIIIIIIIXXXIIIIZIIZIIZIIZIIZIIZII",
        "ZIIZIIZIIIIXXXIIIIIIIIIIIIIIIXXXIIIIZIIZIIZII"
    ]

    try:
        pauli_stabilizers = [stim.PauliString(s) for s in stabilizers]
        
        # Create tableau
        # Using allow_underconstrained=True because we have 44 stabilizers for 45 qubits
        tableau = stim.Tableau.from_stabilizers(
            pauli_stabilizers, 
            allow_underconstrained=True, 
            allow_redundant=True
        )
        
        # Generate circuit using Gaussian elimination method
        circuit = tableau.to_circuit("elimination")
        
        # Verify locally before submitting
        sim = stim.TableauSimulator()
        sim.do(circuit)
        
        valid = True
        failed_count = 0
        for i, s in enumerate(pauli_stabilizers):
            if sim.measure_observable(s): # Returns True if result is -1
                print(f"Stabilizer {i} failed: {stabilizers[i]}")
                failed_count += 1
                valid = False
        
        if valid:
            print("Local verification successful.")
            with open("circuit_45.stim", "w") as f:
                f.write(str(circuit))
        else:
            print(f"Local verification failed. {failed_count} stabilizers failed.")

    except Exception as e:
        print(f"Error: {e}")

if __name__ == "__main__":
    solve()
