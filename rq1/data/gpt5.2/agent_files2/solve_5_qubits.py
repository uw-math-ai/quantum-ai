import stim

def solve():
    # Generators
    target_stabilizers = [
        stim.PauliString("XZZXI"),
        stim.PauliString("IXZZX"),
        stim.PauliString("XIXZZ"),
        stim.PauliString("ZXIXZ")
    ]
    
    # The 5th stabilizer ZZXIX was redundant.
    # This means the group generated by the 4 stabilizers has rank 4.
    # We need to find a 5th operator L that commutes with all 4 but is independent.
    # This will fix the logical qubit to a specific state (e.g. +1 eigenstate of L).
    
    # Let's search for an L.
    # We can iterate over all Pauli strings of weight 1, 2, ... until we find one.
    # Or just use Gaussian elimination to find the kernel of the check matrix.
    
    # Construct the check matrix for the 4 stabilizers.
    # 5 qubits * 2 (X and Z parts) = 10 columns.
    # 4 rows.
    
    # Or simpler: just try random Pauli strings.
    import itertools
    
    def find_logical_op(stabilizers):
        for length in range(1, 6):
            for p in itertools.product("IXYZ", repeat=length):
                # Pad with I to length 5
                # Actually just iterate over all 5-qubit Paulis? That's 4^5 = 1024.
                # Fast enough.
                pauli_str = "".join(p) + "I" * (5 - length)
                # But we want all permutations.
                # Let's just do product of 5.
                pass
        
        for p in itertools.product("IXYZ", repeat=5):
            s = "".join(p)
            ps = stim.PauliString(s)
            
            # Check commutation with all stabilizers
            commutes = True
            for stab in stabilizers:
                if not ps.commutes(stab):
                    commutes = False
                    break
            
            if commutes:
                # Check independence
                # We can check if adding it increases rank.
                # A quick way is to try creating a Tableau with it.
                # If it fails with "redundant", it's dependent.
                # If it succeeds, we found our 5th generator.
                try:
                    stim.Tableau.from_stabilizers(stabilizers + [ps])
                    return ps
                except ValueError:
                    continue
        return None

    L = find_logical_op(target_stabilizers)
    if L:
        print(f"Found 5th stabilizer: {L}")
        full_stabilizers = target_stabilizers + [L]
        t = stim.Tableau.from_stabilizers(full_stabilizers)
        circuit = t.to_circuit("elimination")
        print("Circuit found:")
        print(circuit)
    else:
        print("Could not find logical operator.")


if __name__ == "__main__":
    solve()
