import stim
import numpy as np

# List of stabilizers from the prompt
stabilizers = [
"XXIIXXIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII", 
"IIIIIIIXXIIXXIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII", 
"IIIIIIIIIIIIIIXXIIXXIIIIIIIIIIIIIIIIIIIIIIIIIIIII", 
"IIIIIIIIIIIIIIIIIIIIIXXIIXXIIIIIIIIIIIIIIIIIIIIII", 
"IIIIIIIIIIIIIIIIIIIIIIIIIIIIXXIIXXIIIIIIIIIIIIIII", 
"IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIXXIIXXIIIIIIII", 
"IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIXXIIXXI", 
"XIXIXIXIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII", 
"IIIIIIIXIXIXIXIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII", 
"IIIIIIIIIIIIIIXIXIXIXIIIIIIIIIIIIIIIIIIIIIIIIIIII", 
"IIIIIIIIIIIIIIIIIIIIIXIXIXIXIIIIIIIIIIIIIIIIIIIII", 
"IIIIIIIIIIIIIIIIIIIIIIIIIIIIXIXIXIXIIIIIIIIIIIIII", 
"IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIXIXIXIXIIIIIII", 
"IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIXIXIXIX", 
"IIIXXXXIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII", 
"IIIIIIIIIIXXXXIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII", 
"IIIIIIIIIIIIIIIIIXXXXIIIIIIIIIIIIIIIIIIIIIIIIIIII", 
"IIIIIIIIIIIIIIIIIIIIIIIIXXXXIIIIIIIIIIIIIIIIIIIII", 
"IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIXXXXIIIIIIIIIIIIII", 
"IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIXXXXIIIIIII", 
"IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIXXXX", 
"ZZIIZZIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII", 
"IIIIIIIZZIIZZIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII", 
"IIIIIIIIIIIIIIZZIIZZIIIIIIIIIIIIIIIIIIIIIIIIIIIII", 
"IIIIIIIIIIIIIIIIIIIIIZZIIZZIIIIIIIIIIIIIIIIIIIIII", 
"IIIIIIIIIIIIIIIIIIIIIIIIIIIIZZIIZZIIIIIIIIIIIIIII", 
"IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIZZIIZZIIIIIIII", 
"IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIZZIIZZI", 
"ZIZIZIZIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII", 
"IIIIIIIZIZIZIZIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII", 
"IIIIIIIIIIIIIIZIZIZIZIIIIIIIIIIIIIIIIIIIIIIIIIIII", 
"IIIIIIIIIIIIIIIIIIIIIZIZIZIZIIIIIIIIIIIIIIIIIIIII", 
"IIIIIIIIIIIIIIIIIIIIIIIIIIIIZIZIZIZIIIIIIIIIIIIII", 
"IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIZIZIZIZIIIIIII", 
"IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIZIZIZIZ", 
"IIIZZZZIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII", 
"IIIIIIIIIIZZZZIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII", 
"IIIIIIIIIIIIIIIIIZZZZIIIIIIIIIIIIIIIIIIIIIIIIIIII", 
"IIIIIIIIIIIIIIIIIIIIIIIIZZZZIIIIIIIIIIIIIIIIIIIII", 
"IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIZZZZIIIIIIIIIIIIII", 
"IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIZZZZIIIIIII", 
"IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIZZZZ", 
"XXXIIIIXXXIIIIXXXIIIIXXXIIIIIIIIIIIIIIIIIIIIIIIII", 
"XXXIIIIIIIIIIIXXXIIIIIIIIIIIXXXIIIIIIIIIIIXXXIIII", 
"IIIIIIIIIIIIIIXXXIIIIXXXIIIIXXXIIIIXXXIIIIIIIIIII", 
"ZZZIIIIZZZIIIIZZZIIIIZZZIIIIIIIIIIIIIIIIIIIIIIIII", 
"ZZZIIIIIIIIIIIZZZIIIIIIIIIIIZZZIIIIIIIIIIIZZZIIII", 
"IIIIIIIIIIIIIIZZZIIIIZZZIIIIZZZIIIIZZZIIIIIIIIIII"
]

print(f"Number of stabilizers provided: {len(stabilizers)}")

# Convert to stim PauliStrings
paulis = [stim.PauliString(s) for s in stabilizers]
num_qubits = len(stabilizers[0])
print(f"Number of qubits: {num_qubits}")

# Check commutation
commutes = True
for i in range(len(paulis)):
    for j in range(i + 1, len(paulis)):
        if not paulis[i].commutes(paulis[j]):
            print(f"Stabilizers {i} and {j} do not commute!")
            commutes = False
            break
    if not commutes: break

if commutes:
    print("All stabilizers commute.")
else:
    print("Stabilizers do NOT commute.")

# Check independence (rank)
# We can use Gaussian elimination to find the rank.
# Or just let Stim handle it (Tableau.from_stabilizers fails if not independent? No, it handles it if we complete it carefully)

def check_independence(pauli_list):
    # Simple Gaussian elimination over GF(2) in symplectic representation
    # x_bits + z_bits
    matrix = []
    for p in pauli_list:
        xs = [1 if p[k] in [1, 2] else 0 for k in range(num_qubits)] # 1=X, 2=Y, 3=Z. Stim enc: 0=I, 1=X, 2=Y, 3=Z
        zs = [1 if p[k] in [2, 3] else 0 for k in range(num_qubits)]
        matrix.append(xs + zs)
    
    mat = np.array(matrix, dtype=int)
    
    # Row reduction
    rows, cols = mat.shape
    pivot_row = 0
    for col in range(cols):
        if pivot_row >= rows: break
        
        # Find pivot
        pivot = -1
        for r in range(pivot_row, rows):
            if mat[r, col] == 1:
                pivot = r
                break
        
        if pivot != -1:
            # Swap
            mat[[pivot_row, pivot]] = mat[[pivot, pivot_row]]
            
            # Eliminate
            for r in range(rows):
                if r != pivot_row and mat[r, col] == 1:
                    mat[r] ^= mat[pivot_row]
            
            pivot_row += 1
            
    rank = pivot_row
    return rank

rank = check_independence(paulis)
print(f"Rank of stabilizers: {rank}")
