import stim
import sys

stabilizers = [
    "IXXIIIIIIIIIIIIIIIXIIIIIIIIIIIIIIIIIIIIXIIXIIIIIXIIIIIIIIIIIIIIIIIIIIIII",
    "IIXXIIIIIIIIIIIIIIIXIIIIIIIIIIIIIIIIIIIIXIIXIIIIIXIIIIIIIIIIIIIIIIIIIIII",
    "IIIXXIIIIIIIIIIIIIIIXIIIIIIIIIIIIIIIIIIIIXIIXIIIIIXIIIIIIIIIIIIIIIIIIIII",
    "IIIIXXIIIIIIIIIIIIIIIXIIIIIIIIIIIIIIXIIIIIIIIXIIIIIXIIIIIIIIIIIIIIIIIIII",
    "XIIIIXIIIIIIIIIIIIIIIIXIIIIIIIIIIIIIIXIIIIIIIIXIIIIIXIIIIIIIIIIIIIIIIIII",
    "XXIIIIIIIIIIIIIIIIIIIIIXIIIIIIIIIIIIIIXIIIIIIIIXIIIIIXIIIIIIIIIIIIIIIIII",
    "IIIIIIIXXIIIIIIIIIIIIIIIXIIIIIIIIIIIIIIIIIIIIXIIXIIIIIXIIIIIIIIIIIIIIIII",
    "IIIIIIIIXXIIIIIIIIIIIIIIIXIIIIIIIIIIIIIIIIIIIIXIIXIIIIIXIIIIIIIIIIIIIIII",
    "IIIIIIIIIXXIIIIIIIIIIIIIIIXIIIIIIIIIIIIIIIIIIIIXIIXIIIIIXIIIIIIIIIIIIIIIII",
    "IIIIIIIIIIXXIIIIIIIIIIIIIIIXIIIIIIIIIIIIIIXIIIIIIIIXIIIIIXIIIIIIIIIIIIII",
    "IIIIIIXIIIIXIIIIIIIIIIIIIIIIXIIIIIIIIIIIIIIXIIIIIIIIXIIIIIXIIIIIIIIIIIII",
    "IIIIIIXXIIIIIIIIIIIIIIIIIIIIIXIIIIIIIIIIIIIIXIIIIIIIIXIIIIIXIIIIIIIIIIII",
    "IIIIIIIIIIIIIXXIIIIIIIIIIIIIIIXIIIIIIIIIIIIIIIIIIIIXIIXIIIIIXIIIIIIIIIII",
    "IIIIIIIIIIIIIIXXIIIIIIIIIIIIIIIXIIIIIIIIIIIIIIIIIIIIXIIXIIIIIXIIIIIIIIII",
    "IIIIIIIIIIIIIIIXXIIIIIIIIIIIIIIIXIIIIIIIIIIIIIIIIIIIIXIIXIIIIIXIIIIIIIII",
    "IIIIIIIIIIIIIIIIXXIIIIIIIIIIIIIIIXIIIIIIIIIIIIIIXIIIIIIIIXIIIIIXIIIIIIII",
    "IIIIIIIIIIIIXIIIIXIIIIIIIIIIIIIIIIXIIIIIIIIIIIIIIXIIIIIIIIXIIIIIXIIIIIII",
    "IIIIIIIIIIIIXXIIIIIIIIIIIIIIIIIIIIIXIIIIIIIIIIIIIIXIIIIIIIIXIIIIIXIIIIII",
    "XIIIIIIIIIIIIIIIIIIXXIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIXIIXIIIIIXIIIII",
    "IXIIIIIIIIIIIIIIIIIIXXIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIXIIXIIIIIXIIII",
    "IIXIIIIIIIIIIIIIIIIIIXXIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIXIIXIIIIIXIII",
    "IIIXIIIIIIIIIIIIIIIIIIXXIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIXIIIIIIIIXIIIIIXII",
    "IIIIXIIIIIIIIIIIIIXIIIIXIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIXIIIIIIIIXIIIIIXI",
    "IIIIIXIIIIIIIIIIIIXXIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIXIIIIIIIIXIIIIIX",
    "IIIIIIXIIIIIIIIIIIIIIIIIIXXIIIIIIIIIXIIIIIIIIIIIIIIIIIIIIIIIIIIXIIXIIIII",
    "IIIIIIIXIIIIIIIIIIIIIIIIIIXXIIIIIIIIIXIIIIIIIIIIIIIIIIIIIIIIIIIIXIIXIIII",
    "IIIIIIIIXIIIIIIIIIIIIIIIIIIXXIIIIIIIIIXIIIIIIIIIIIIIIIIIIIIIIIIIIXIIXIII",
    "IIIIIIIIIXIIIIIIIIIIIIIIIIIIXXIIIIIIIIIXIIIIIIIIIIIIIIIIIIIIXIIIIIIIIXII",
    "IIIIIIIIIIXIIIIIIIIIIIIIXIIIIXIIIIIIIIIIXIIIIIIIIIIIIIIIIIIIIXIIIIIIIIXI",
    "IIIIIIIIIIIXIIIIIIIIIIIIXXIIIIIIIIIIIIIIIXIIIIIIIIIIIIIIIIIIIIXIIIIIIIIX",
    "IIIIIIIIIIIIXIIIIIIIIIIIIIIIIIIXXIIIXIIIIIXIIIIIIIIIIIIIIIIIIIIIIIIIIXII",
    "IIIIIIIIIIIIIXIIIIIIIIIIIIIIIIIIXXIIIXIIIIIXIIIIIIIIIIIIIIIIIIIIIIIIIIXI",
    "IIIIIIIIIIIIIIXIIIIIIIIIIIIIIIIIIXXIIIXIIIIIXIIIIIIIIIIIIIIIIIIIIIIIIIIX",
    "IIIIIIIIIIIIIIIXIIIIIIIIIIIIIIIIIIXXIIIXIIIIIXIIIIIIIIIIIIIIIIIIIIXIIIII",
    "IIIIIIIIIIIIIIIIXIIIIIIIIIIIIIXIIIIXIIIIXIIIIIXIIIIIIIIIIIIIIIIIIIIXIIII",
    "IIIIIIIIIIIIIIIIIXIIIIIIIIIIIIXXIIIIIIIIIXIIIIIXIIIIIIIIIIIIIIIIIIIIXIII",
    "IIIZIIIIIIIIIIIIIIIIIIIIZIIIIIZIIIIIIIIIZZIIIIIIIIIIIIZIIIIIIIIIIIIIIIII",
    "IIIIZIIIIIIIIIIIIIIIIIIIIZIIIIIZIIIIZIIIIZIIIIIIIIIIIIIZIIIIIIIIIIIIIIII",
    "IIIIIZIIIIIIIIIIIIIIIIIIIIZIIIIIZIIIZZIIIIIIIIIIIIIIIIIIZIIIIIIIIIIIIIII",
    "ZIIIIIIIIIIIIIIIIIIIIIIIIIIZIIIIIZIIIZZIIIIIIIIIIIIIIIIIIZIIIIIIIIIIIIII",
    "IZIIIIIIIIIIIIIIIIIIIIIIIIIIZIIIIIZIIIZZIIIIIIIIIIIIIIIIIIZIIIIIIIIIIIIIII",
    "IIZIIIIIIIIIIIIIIIIIIIIIIIIIIZIIIIIZIIIZZIIIIIIIIIIIIIIIIIIZIIIIIIIIIIII",
    "ZIIIIIIIIZIIIIIIIIIIIIIIIIIIIIZIIIIIIIIIIIIIIIZZIIIIIIIIIIIIZIIIIIIIIIII",
    "IZIIIIIIIIZIIIIIIIIIIIIIIIIIIIIZIIIIIIIIIIZIIIIZIIIIIIIIIIIIIZIIIIIIIIII",
    "IIZIIIIIIIIZIIIIIIIIIIIIIIIIIIIIZIIIIIIIIIZZIIIIIIIIIIIIIIIIIIZIIIIIIIII",
    "IIIZIIZIIIIIIIIIIIIIIIIIIIIIIIIIIZIIIIIIIIIZZIIIIIIIIIIIIIIIIIIZIIIIIIII",
    "IIIIZIIZIIIIIIIIIIIIIIIIIIIIIIIIIIZIIIIIIIIIZZIIIIIIIIIIIIIIIIIIZIIIIIII",
    "IIIIIZIIZIIIIIIIIIIIIIIIIIIIIIIIIIIZIIIIIIIIIZZIIIIIIIIIIIIIIIIIIZIIIIII",
    "ZIIIIIZIIIIIIIIZIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIZZIIIIIIIIIIIIZIIIII",
    "IZIIIIIZIIIIIIIIZIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIZIIIIZIIIIIIIIIIIIIZIIII",
    "IIZIIIIIZIIIIIIIIZIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIZZIIIIIIIIIIIIIIIIIIZIII",
    "IIIZIIIIIZIIZIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIZZIIIIIIIIIIIIIIIIIIZII",
    "IIIIZIIIIIZIIZIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIZZIIIIIIIIIIIIIIIIIIZI",
    "IIIIIZIIIIIZIIZIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIZZIIIIIIIIIIIIIIIIIIZ",
    "IIIIIIZIIIIIZIIIIIIIIZIIIIIIIIIIIIIIZIIIIIIIIIIIIIIIIIIIIIZZIIIIIIIIIIII",
    "IIIIIIIZIIIIIZIIIIIIIIZIIIIIIIIIIIIIIZIIIIIIIIIIIIIIIIZIIIIZIIIIIIIIIIII",
    "IIIIIIIIZIIIIIZIIIIIIIIZIIIIIIIIIIIIIIZIIIIIIIIIIIIIIIZZIIIIIIIIIIIIIIII",
    "IIIIIIIIIZIIIIIZIIZIIIIIIIIIIIIIIIIIIIIZIIIIIIIIIIIIIIIZZIIIIIIIIIIIIIII",
    "IIIIIIIIIIZIIIIIZIIZIIIIIIIIIIIIIIIIIIIIZIIIIIIIIIIIIIIIZZIIIIIIIIIIIIII",
    "IIIIIIIIIIIZIIIIIZIIZIIIIIIIIIIIIIIIIIIIIZIIIIIIIIIIIIIIIZZIIIIIIIIIIIIIII",
    "IIIIIIIIIIIIZIIIIIZIIIIIIIIZIIIIIIIIIIIIIIZIIIIIIIIIIIIIIIIIIIIIZZIIIIII",
    "IIIIIIIIIIIIIZIIIIIZIIIIIIIIZIIIIIIIIIIIIIIZIIIIIIIIIIIIIIIIZIIIIZIIIIII",
    "IIIIIIIIIIIIIIZIIIIIZIIIIIIIIZIIIIIIIIIIIIIIZIIIIIIIIIIIIIIIZZIIIIIIIIII",
    "IIIIIIIIIIIIIIIZIIIIIZIIZIIIIIIIIIIIIIIIIIIIIZIIIIIIIIIIIIIIIZZIIIIIIIII",
    "IIIIIIIIIIIIIIIIZIIIIIZIIZIIIIIIIIIIIIIIIIIIIIZIIIIIIIIIIIIIIIZZIIIIIIII",
    "IIIIIIIIIIIIIIIIIZIIIIIZIIZIIIIIIIIIIIIIIIIIIIIZIIIIIIIIIIIIIIIZZIIIIIII",
    "IIIIIIIIIIIIIIIIIIZIIIIIZIIIIIIIIZIIIIIIIIIIIIIIZIIIIIIIIIIIIIIIIIIIIIZZ",
    "IIIIIIIIIIIIIIIIIIIZIIIIIZIIIIIIIIZIIIIIIIIIIIIIIZIIIIIIIIIIIIIIIIZIIIIZ",
    "IIIIIIIIIIIIIIIIIIIIZIIIIIZIIIIIIIIZIIIIIIIIIIIIIIZIIIIIIIIIIIIIIIZZIIII",
    "IIIIIIIIIIIIIIIIIIIIIZIIIIIZIIZIIIIIIIIIIIIIIIIIIIIZIIIIIIIIIIIIIIIZZIII",
    "IIIIIIIIIIIIIIIIIIIIIIZIIIIIZIIZIIIIIIIIIIIIIIIIIIIIZIIIIIIIIIIIIIIIZZII",
    "IIIIIIIIIIIIIIIIIIIIIIIZIIIIIZIIZIIIIIIIIIIIIIIIIIIIIZIIIIIIIIIIIIIIIZZI"
]

try:
    tableau = stim.Tableau.from_stabilizers([stim.PauliString(s) for s in stabilizers], allow_underconstrained=True, allow_redundant=True)
    # Using 'elimination' method as it usually produces a valid circuit
    circuit = tableau.to_circuit("elimination")
    
    with open("circuit_72.stim", "w") as f:
        for instruction in circuit:
            if isinstance(instruction, stim.CircuitInstruction):
                name = instruction.name
                targets = instruction.targets_copy()
                args = instruction.gate_args_copy()
                
                # Check if it's a simple gate without args
                if not args:
                    # Rewrite the loop to handle chunks
                    num_targets = len(targets)
                    current_idx = 0
                    line = f"{name}"
                    
                    # determine chunk size once
                    chunk_size = 1
                    if name in ["CX", "CNOT", "CY", "CZ", "SWAP", "ISWAP", "XCX", "XCY", "XCZ", "YCX", "YCY", "YCZ", "ZCX", "ZCY", "ZCZ", "SQRT_XX", "SQRT_YY", "SQRT_ZZ", "MXX", "MYY", "MZZ"]:
                        chunk_size = 2
                    
                    while current_idx < num_targets:
                        chunk_str = ""
                        for k in range(chunk_size):
                            if current_idx + k < num_targets:
                                t = targets[current_idx + k]
                                t_str = str(t.value)
                                if t.is_x_target: t_str += " X"
                                elif t.is_y_target: t_str += " Y"
                                elif t.is_z_target: t_str += " Z"
                                elif t.is_inverted_result_target: t_str = "!" + t_str
                                elif t.is_measurement_record_target: t_str = "rec[" + t_str + "]"
                                chunk_str += " " + t_str
                        
                        if len(line) + len(chunk_str) > 80:
                            f.write(line + "\n")
                            line = f"{name}" + chunk_str
                        else:
                            line += chunk_str
                        
                        current_idx += chunk_size
                    f.write(line + "\n")
                else:
                    f.write(str(instruction) + "\n")
            else:
                 f.write(str(instruction) + "\n")

    print("Circuit saved to circuit_72.stim")
except Exception as e:
    print(f"Error: {e}")
